<%= hidden_field_tag "authenticity_token", form_authenticity_token %>
<script>
if( navigator.geolocation )
{
  navigator.geolocation.getCurrentPosition(

    function( position )
    {
      var data = position.coords ;

      var lat = data.latitude ;
      var lng = data.longitude ;

      //post geolocation
      $.ajax({
        type :"POST",
        url: "<%= url  %>" , 
        data: {
          lat: lat,
          lng: lng,
          "authenticity_token": $("#authenticity_token").val()
          }
        });

    },

    function( error )
    {
        var errorInfo = [
        "unknown error" ,
        "unauthorized" ,
        "cannot get information" ,
        "timeout"
      ] ;

      var errorNo = error.code ;
      var errorMessage = errorInfo[ errorNo ] ;

      //error handling
      $.ajax({
        type :"POST",
        url: "<%= url  %>" , 
        data: {
          error: errorMessage,
          "authenticity_token": $("#authenticity_token").val()
          }
        });

    } ,

    {
      "enableHighAccuracy": false,
      "timeout": 8000,
      "maximumAge": 2000,
    }

  ) ;
}

else
{
  //error handling
  $.ajax({
    type :"POST",
    url: "<%= url  %>" , 
    data: {
      error: "unsupported browser", 
      "authenticity_token": $("#authenticity_token").val()
      }
    });
}

</script>
